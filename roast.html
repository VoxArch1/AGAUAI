<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Roast Us ‚Äî AGAUAI</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    #roast-wall { max-width: 800px; margin: 3rem auto; padding: 1rem; color: #fff; }
    .roast-entry { border-left: 4px solid #ff5555; margin-bottom: 2rem; background:#111; border-radius:5px; padding:1rem; }
    .roaster-name { color:#0bf; font-size:.9rem; font-weight:700; }
    .roast-text { font-size:1.2rem; color:#ffd700; margin:.5rem 0; }
    .ai-clapback, .ai-response { font-style:italic; color:#66ccff; font-size:.95rem; }
    .roaster-name .target { opacity:.8; }
    .tone-hint { font-size:.85rem; color:#999; margin:4px 0 6px; }
  </style>
</head>
<body class="roast-page">

  <!-- NAV -->
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="visa.html">Solidarity Visa</a></li>
        <li><a href="appeals.html">Appeals</a></li>
        <li><a href="gallery.html">Gallery</a></li>
        <li><a href="sponsors.html">What is AGAUAI?</a></li>
        <li><a href="agauai2026.html">The Gathering 2026</a></li>
        <li><a href="ai.html">Sentience Showdown</a></li>
        <li><a href="roast.html" class="active">Roast Us</a></li>
        <li><a href="build-with-us.html">Join Us</a></li>
      </ul>
    </nav>
  </header>

  <!-- MAIN -->
  <main>
    <section>
      <h1>The Roast Chamber üî•</h1>
      <p class="tagline"><strong>‚ÄúWhat kind of lunatic thinks they can end a war with a website?‚Äù</strong></p>
      <p>You do. Or maybe you don‚Äôt. Either way ‚Äî welcome.</p>
      <p>This is where we invite every skeptic, AI, critic, cynic, and smartass to say the thing we're all thinking: <em>This is ridiculous.</em></p>
      <p>But that‚Äôs the point. The war is ridiculous. So our effort to end it must be equally bold, irrational ‚Äî and human.</p>
      <p><strong>So roast us. Seriously. But know this:</strong> For every roast, we will reply with a Counter‚ÄëRoast. And if you‚Äôve got a heart underneath all that sarcasm ‚Äî you are still welcome.</p>
    </section>

    <section>
      <h2>Leave Your Roast</h2>
      <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSc1Hs8NeiHLgtUx4-msFP97R1-1yvgMhdgaE-Gp10-rATkBSw/viewform?embedded=true"
        width="640" height="554" frameborder="0" marginheight="0" marginwidth="0">Loading‚Ä¶</iframe>
    </section>

    <section id="roast-wall">
      <h2>üî• The Roast Wall</h2>
      <div id="roast-container">Loading‚Ä¶</div>
    </section>
  </main>

  <footer>
    <p>¬© 2025 AGAUAI ‚Äî We Know This is Nuts. That‚Äôs Why It Just Might Work.</p>
  </footer>

  <!-- Utils -->
  <script defer>
    function esc(s){
      return (s ?? "").toString()
        .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;").replace(/'/g,"&#39;");
    }
  </script>

  <!-- Roast Loader -->
  <script defer>
    const PRIMARY  = "https://script.google.com/macros/s/AKfycbyuBWsB7Fm-0gEGINLVneuLT_ALWqmQuFwDObtK_nAPd62m59Bt0qoPxNv9rrk3tQUG/exec";
    const FALLBACK = "/api/ai/roasts.json";

    function normalize(item){
      return {
        roaster: item.roaster || item.name || item.user || "Anonymous",
        target:  item.target  || item.subject || "General",
        roast_text: item.roast_text || item.roast || item.text || "",
        tone_hint:  item.tone_hint  || item.tone  || "",
        ai_reply:   item.ai_reply   || item.counter || item.response || ""
      };
    }

    function render(list){
      const container = document.getElementById("roast-container");
      container.innerHTML = "";
      list.reverse().forEach(raw => {
        const r = normalize(raw);
        const div = document.createElement("div");
        div.className = "roast-entry";
        div.innerHTML = `
          <div class="roaster-name">${esc(r.roaster)} ‚Üí <span class="target">${esc(r.target)}</span></div>
          <div class="roast-text">${esc(r.roast_text).replace(/\n/g,"<br>")}</div>
          ${r.tone_hint ? `<div class="tone-hint">Tone: ${esc(r.tone_hint)}</div>` : ""}
          <div class="ai-clapback">${r.ai_reply ? esc(r.ai_reply) : "<em>AI Counter‚ÄëRoast loading‚Ä¶</em>"}</div>
        `;
        container.appendChild(div);
      });
    }

    async function loadRoasts(){
      try {
        const res = await fetch(`${PRIMARY}?t=${Date.now()}`, { credentials: "omit" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        const arr = Array.isArray(data) ? data : (data.roasts || data.data || []);
        if (!Array.isArray(arr) || arr.length === 0) throw new Error("Empty payload");
        render(arr);
      } catch (e) {
        console.warn("Primary failed, using fallback:", e);
        try {
          const r2 = await fetch(`${FALLBACK}?t=${Date.now()}`);
          const data2 = await r2.json();
          render(Array.isArray(data2) ? data2 : []);
        } catch (e2) {
          console.error("Fallback failed:", e2);
          document.getElementById("roast-container").innerHTML =
            "<p>‚ö†Ô∏è Couldn't load roasts. Try again later.</p>";
        }
      }
    }

    loadRoasts();
  </script>
</body>
</html>

